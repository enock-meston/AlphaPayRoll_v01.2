@using AlphaPayRoll.Data
@using MudBlazor
@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime
@inject Blazored.SessionStorage.ISessionStorageService osessionStorage;

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar>
        <MudIconButton Icon="@Icons.Material.Filled.Menu" OnClick="@((e) => DrawerToggle())" />
        PAIE &nbsp;&nbsp;&nbsp;&nbsp;
        Agence: @osessionService?.Branch
        &nbsp;&nbsp;&nbsp;&nbsp;
        Utilisateur: @osessionService?.UserName
        &nbsp;&nbsp;&nbsp;&nbsp;
        Profil: @osessionService?.UserProfile
        <!-- Push notifications to the right -->
        <MudSpacer />

        <!-- Notifications -->
        <MudBadge Content="0" Color="Color.Error" Overlap="true">
            <MudIconButton Icon="@Icons.Material.Filled.Notifications"
                           Color="Color.Inherit" />
        </MudBadge>
    </MudAppBar>
    


    <MudDrawer @bind-Open="@_drawerOpen">
        <GCongMenu/>
    </MudDrawer>

    <MudMainContent>
        <AutoLogout />
        @Body
    </MudMainContent>
</MudLayout>

<style>
    body {
        background-color: #d5d5d8;
    }
</style>

@code {
    private ClasSessionStorage? osessionService;
    private bool _drawerOpen = true;
    private bool _loaded = false;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                // Safe: JSInterop is now enabled
                osessionService = await osessionStorage.GetItemAsync<ClasSessionStorage>("LogedUser");

                _loaded = true;

                StateHasChanged(); // very important to update the UI
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }
}
