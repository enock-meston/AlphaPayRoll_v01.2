@using AlphaPayRoll.Data
@inject IJSRuntime JSRuntime
@inject NavigationManager NavManager
@* @inject SessionService osessionService *@
@inject Blazored.SessionStorage.ISessionStorageService osessionStorage;



<MudDrawerHeader Style="background-color: white; ">
    <MudAvatar Color="Color.Transparent" Size="Size.Large" Image="Images/RIMICON1.png" />
    <MudText Typo="Typo.h5" Color="Color.Primary" Style="margin-top:10px;margin-left:15px">AlphaPay</MudText>
    <MudIconButton Color="Color.Inherit" />
</MudDrawerHeader>

<MudNavMenu Style="background-color: cadetblue; color: white;">


    <MudNavLink Match="NavLinkMatch.Prefix" @onclick="PlanningCongeFct" Style="height 5%;" Class="Menux" id="menu-planning">Planifier un congé</MudNavLink>
    <MudNavLink Match="NavLinkMatch.Prefix" @onclick="DemandeCongeFct" Style="height 5%;" Class="Menux" id="menu-demande">Demande de congé</MudNavLink>

    @if (osessionService != null && osessionService.RoleID != 1)
    {
        <MudDivider class="my-2"></MudDivider>
        @if (osessionService.RoleID == 2)
        {
            <MudNavLink Match="NavLinkMatch.Prefix" @onclick="CongeChefDirMenu" Style="height 5%;" Class="Menux" id="menu-permission">Congé chef Dir </MudNavLink>

        }

        @if (osessionService.RoleID == 3)
        {
            <MudNavLink Match="NavLinkMatch.Prefix" @onclick="CongeHRMenu" Style="height 5%;" Class="Menux" id="menu-permission">Congé HR</MudNavLink>

        }

        @if (osessionService.RoleID == 4)
        {
            <MudNavLink Match = "NavLinkMatch.Prefix" @onclick = "CongeDGMenu" Style = "height 5%;" Class = "Menux" id = "menu-permission" > Congé DG </MudNavLink>

        }




        <MudDivider class="my-2"></MudDivider>
    }

    @if (osessionService != null && osessionService.RoleID == 1)
    {
        <MudNavLink Match="NavLinkMatch.Prefix" @onclick="StatusDemandeCongeMenu" Style="height 5%;" Class="Menux" id="menu-permission">Congé Consult Statut  </MudNavLink>

    }

    <MudNavLink Match="NavLinkMatch.Prefix" @onclick="CongeCirc" Style="height 5%;" Class="Menux" id="menu-circ">Congé Circ.</MudNavLink>
    <MudNavLink Match="NavLinkMatch.Prefix" @onclick="Permission" Style="height 5%;" Class="Menux" id="menu-permission">Demande de Permission</MudNavLink>

    @* <MudNavLink Match="NavLinkMatch.Prefix" @onclick="DonBase" Style="height :5%;" Class="Menux">All Transaction </MudNavLink> *@
    @* <MudNavLink Match="NavLinkMatch.Prefix" @onclick="TxDAT" Style="height :5%;" Class="Menux"> DAT </MudNavLink> *@
    @* <MudNavLink Match="NavLinkMatch.Prefix" @onclick="Parametrage" Style="height 5%;" Class="Menux">Parametrage</MudNavLink> *@
    <MudNavLink Match="NavLinkMatch.All" @onclick="ChangePassWord" Style="height 5%;" Class="Menux" id="menu-password">Change MP</MudNavLink>
    <MudNavLink Match="NavLinkMatch.All" @onclick="LogOutFct" Style="height 5%;" Class="Menux" id="menu-logout">Logout</MudNavLink>

</MudNavMenu>


@code {
    [Parameter]
    public bool SideBarOpen { set; get; } = true;
    public ClasSessionStorage osessionService { set; get; }


    public string paramTeller = "102";
    public string paramSafe = "108";
    public string paramVault = "70";

    public void DemandeCongeFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongeRequestF/CongeRequestPage");
    }

    public void CongeCirc()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongeCircRequest/CongeCircRequestPage/1");
    }

    public void PrepSalaireFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/TRH02Agent/AgentMajSalPage/1");
    }

    public void CalculSalaireFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/SalProcess/SalCalculPage/1");
    }

    public void ConstationSalairesFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/TSL09ImputPay/ConstatSalairePage/1");
    }

    public void VirementSalairesFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/TSL09ImputPay/TSL09ImputPayPage/1");
    }

    public void VirementRemboursFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/TSL09ImputPay/ImputRembCreditPage/1");
    }

    public void ArchiverSalairesFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/SalProcess/ArchiverSalairesPage/1");
    }

    public void NouveauRecrutFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/TRH02Agent/AgentPage/1");
    }

    public void ContratFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/Contrat/ContratPage/1");
    }

    public void ContratModif()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/ContratModif/THR05ContratModif/1");
    }

    public void PostModif()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/PostModif/TRH05PostModifPage/1");
    }

    public void AffectationFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/Contrat/AffectationPage/1");
    }

    public void PlanningCongeFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/PlanningConge/PlanningCongePages/1");
    }

    public void Permission()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/HumanResource/TRH05PermissionPages");
    }
    // ==== adminstration congé

    public void StatusDemandeCongeMenu()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongConsult/CongConsultStatusPage");
    }

    public void CongeChefDirMenu()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongeResponceChefDir/CongeResponceChefDirPage");
    }

    public void CongeHRMenu()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongeResponceHR/CongeResponceHRPage");
    }

    public void CongeDGMenu()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/CongeResponceDG/CongeResponceDGPage");
    }

    //========= end of adminstration conge

    public void Parametrage()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/settings/TypeCongCircons/TRH051TypeCongCirconsPage/1");
    }

    public void DonBase()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/DonBase/TCt550TpTransToutPage");
    }
    public void TxDAT()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/DonBase/TxDAT/TCpt050TxDATPage");
    }

    public void DepartFct()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/Depart/DepartPage/1");
    }

    public void Sanction()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/HumanResource/TRH05SactionPage");
    }

    public void Training()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/HumanResource/TRH03TrainingPage");
    }

    public void Faute()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/HumanResource/TRH04FAUTEPage");
    }

    public void Mutation()
    {

        NavManager.NavigateTo(osessionService.sApp + "/home");
        NavManager.NavigateTo(osessionService.sApp + $"/HumanResource/TRH05MutationPage");
    }

    public void ChangePassWord()
    {

        NavManager.NavigateTo(osessionService.sApp + $"/home");
        NavManager.NavigateTo(osessionService.sApp + $"/Login/ChangePswPage");
    }

    public void ReportEmbarqFct()
    {

        NavManager.NavigateTo(osessionService.sApp + $"/home");
        NavManager.NavigateTo(osessionService.sApp + $"/AgentComReport/AgentComReportPage");
    }

    public void ReportListPayFct()
    {

        NavManager.NavigateTo(osessionService.sApp + $"/home");
        NavManager.NavigateTo(osessionService.sApp + $"/AgentSalaireReport/AgentSalaireReportPage");
    }

    public async Task LogOutFct()
    {
        if (!await JSRuntime.InvokeAsync<bool>("confirm", $"Are you sure you want to Lougout ?"))
            return;

        // osessionService.VraiID = 0;
        // osessionService.ClientID = 0;
        // osessionService.RoleID = 0;
        // osessionService.CashAcctID = 0;
        // osessionService.Reponse = "Cliquer sur le bouton Login pour vous connecter";
        // osessionService.DateJour = DateTime.Today;
        // osessionService.JournalName = "";
        // osessionService.Branch = "";
        // osessionService.IsLogged = false;
        // osessionService.UserProfile = "";
        // osessionService.UserId = 0;
        // osessionService.UserName = "";
        // osessionService.BranchID = 0;
        // osessionService.MenuId = "0";
        // osessionService.MenuSecId = "0";
        // osessionService.MenuName = "";
        // osessionService.MenuSecName = "";
        // osessionService.DivMessage = "";
        // osessionService.CustomerNames = "";
        // osessionService.DataChanged = false;
        // osessionService.ContratID = 0;
        // osessionService.DernSouscriptID = 0;

        NavManager.NavigateTo(osessionService.sApp + $"/");

    }

    // protected override async Task OnAfterRenderAsync(bool firstRender)
    // {
    //     try
    //     {
    //         if (firstRender)
    //         {
    //             osessionService = await osessionStorage.GetItemAsync<ClasSessionStorage>("LogedUser");

    //             // strUserName = osessionService.UserName;
    //             await InvokeAsync(StateHasChanged);
    //         }
    //     }
    //     catch (Exception ex)
    //     {
    //         await JSRuntime.InvokeVoidAsync("alert", ex.Message);
    //     }
    // }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            osessionService = await osessionStorage.GetItemAsync<ClasSessionStorage>("LogedUser");
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", ex.Message);
        }
    }
}